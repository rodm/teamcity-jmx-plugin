
apply plugin: 'java'
apply plugin: 'sonar-runner'

project.ext.teamCityVersion = System.properties['teamcity.version'] ?: '8.1.5'

sourceCompatibility = 1.7
targetCompatibility = 1.7

archivesBaseName = "jmx-plugin"

repositories {
    mavenCentral()
    maven {
        url "http://repository.jetbrains.com/all"
    }
}

dependencies {
    compile group: 'org.jetbrains.teamcity', name: 'server-api', version: "${teamCityVersion}"

    testCompile group: 'junit', name: 'junit', version: '4.11'
    testCompile group: 'org.mockito', name: 'mockito-core', version: '1.9.5'
}

jar {
    exclude "**/teamcity-plugin.xml"
}

task packagePlugin(type: Zip, dependsOn: jar) {
    destinationDir = file('dist')
    from(jar.outputs.files) {
        into 'server'
    }
    from("$buildDir/resources/main") {
        include 'teamcity-plugin.xml'
    }
}

assemble.dependsOn packagePlugin
